#!/bin/bash

set -e

if [[ ! "$_PYAV_ACTIVATED" ]]; then
    export here="$(cd "$(dirname "${BASH_SOURCE[0]}")"; pwd)"
    source "$here/activate.sh"
fi

cd "$PYAV_ROOT"


if [[ ! "$TRAVIS" || "$TESTSUITE" == flake8 ]]; then
    $PYAV_PYTHON -m flake8 av examples tests
    if [[ "$TRAVIS" && $? != 0 ]]; then
        exit 1
    fi
fi

if [[ ! "$TRAVIS" || "$TESTSUITE" == isort ]]; then
    $PYAV_PYTHON -m isort -df -rc examples tests
    if [[ "$TRAVIS" && $? != 0 ]]; then
        exit 1
    fi
fi

if [[ ! "$TRAVIS" || ! "$TESTSUITE" ]]; then
    $PYAV_PYTHON setup.py test
    if [[ "$TRAVIS" && $? != 0 ]]; then
        exit 1
    fi
fi
